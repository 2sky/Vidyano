<link rel="import" href="../QueryGrid/query-grid.html" />
<link rel="import" href="../Chart/chart-dependencies.html" />

<dom-module id="vi-profiler">
    <template>
        <link rel="stylesheet" href="profiler.css" />
        <vi-popup sticky>
            <div header class="flex layout horizontal">
                <vi-icon source="Profiler"></vi-icon>
                <div class="flex" hidden="[[lastRequest]]">[[awaiting]]</div>
                <div class="flex layout horizontal" hidden="[[!lastRequest]]" id="lastRequest">
                    <div>
                        <label>Method</label>
                        <h1>[[lastRequest.method]]</h1>
                    </div>
                    <template is="dom-repeat" items="[[lastRequestParameters]]" as="parameter">
                        <div>
                            <label>[[parameter.key]]</label>
                            <h1>[[parameter.value]]</h1>
                        </div>
                    </template>
                    <div>
                        <label>Server</label>
                        <h1>[[lastRequest.profiler.elapsedMilliseconds]]ms</h1>
                    </div>
                    <div>
                        <label>Transport</label>
                        <h1>[[lastRequest.transport]]ms</h1>
                    </div>
                </div>
                <button is="vi-button" icon="Remove" type="light-monochrome" inverse on-tap="_close"></button>
            </div>
            <div content class="layout horizontal">
                <vi-query-grid query="[[query]]" on-item-tap="_gridItemTap"></vi-query-grid>
                <div class="flex relative">
                    <vi-size-tracker size="{{timelineSize}}"></vi-size-tracker>
                    <vi-scroller id="timelineScroller" class="fit" no-vertical>
                        <svg id="timeline" on-mousewheel="_onMousewheel">
                            <g class="xaxis"></g>
                        </svg>
                    </vi-scroller>
                    <div id="hoveredEntry" hidden$="[[!hoveredEntry]]">
                        <table>
                            <tr>
                                <td>Method</td>
                                <td>[[hoveredEntry.methodName]]</td>
                            </tr>
                            <tr>
                                <td>Total time</td>
                                <td>[[_formatMs(hoveredEntry.elapsedMilliseconds)]]</td>
                            </tr>
                            <tr>
                                <td>SQL statements</td>
                                <td>[[hoveredEntry.sql.length]]</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </vi-popup>
    </template>
</dom-module>

<script src="profiler.js"></script>