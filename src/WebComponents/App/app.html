<link rel="import" href="../../Libs/iron-a11y-keys/iron-a11y-keys.html" />
<link rel="import" href="../../Libs/iron-media-query/iron-media-query.html" />
<link rel="import" href="../WebComponent/webcomponent.html" />
<link rel="import" href="../Spinner/spinner.html" />
<link rel="import" href="../AppRoute/app-route.html" />
<link rel="import" href="../AttachedNotifier/attached-notifier.html" />
<link rel="import" href="../SizeTracker/size-tracker.html" />
<link rel="import" href="../Resource/resource.html" />
<link rel="import" href="../Grid/grid.html" />
<link rel="import" href="../Icon/icon.html" />
<link rel="import" href="../Button/button.html" />
<link rel="import" href="../Scroller/scroller.html" />
<link rel="import" href="../SessionPresenter/session-presenter.html" />
<link rel="import" href="../Menu/menu.html" />
<link rel="import" href="../Spinner/spinner.html" />
<link rel="import" href="../Overflow/overflow.html" />
<link rel="import" href="../Dialog/dialog.html" />
<link rel="import" href="../MessageDialog/message-dialog.html" />
<link rel="import" href="../Popup/popup.html" />
<link rel="import" href="../PopupMenu/popup-menu.html" />
<link rel="import" href="../ProgramUnitPresenter/program-unit-presenter.html" />
<link rel="import" href="../PersistentObjectPresenter/persistent-object-presenter.html" />
<link rel="import" href="../PersistentObjectAttributePresenter/persistent-object-attribute-presenter.html" />
<link rel="import" href="../PersistentObjectDialog/persistent-object-dialog.html" />
<link rel="import" href="../QueryPresenter/query-presenter.html" />
<link rel="import" href="../QueryItemsPresenter/query-items-presenter.html" />
<link rel="import" href="../SignIn/sign-in.html" />
<link rel="import" href="../SignOut/sign-out.html" />

<dom-module id="vi-app">
    <template>
        <link rel="stylesheet" href="app.css" />
        <iron-a11y-keys keys="[[keys]]" on-keys-pressed="_keysPressed"></iron-a11y-keys>
        <iron-media-query query="(max-width: 479px)" query-matches="{{isPhone}}"></iron-media-query>
        <iron-media-query query="(min-width: 480px) and (max-width: 839px)" query-matches="{{isTablet}}"></iron-media-query>
        <iron-media-query query="(min-width: 840px)" query-matches="{{isDesktop}}"></iron-media-query>
        <template is="dom-if" if="[[isTrial]]">
            <div id="trial" inner-h-t-m-l="[[_computeTrialMessage(isTrial)]]"></div>
        </template>
        <vi-profiler service="[[service]]" hidden$="[[!isProfiling]]"></vi-profiler>
        <vi-spinner hidden$="[[!initializing]]"></vi-spinner>
        <template is="dom-if" if="[[showMenu]]" restamp>
            <vi-menu menu label="[[label]]" program-units="[[service.application.programUnits]]" active-program-unit="[[programUnit]]">
                <content select="[label]:not([label='sign-in'])"></content>
            </vi-menu>
        </template>
        <vi-app-route route="Error/:message" component="Vidyano.WebComponents.AppRouteError"></vi-app-route>
        <vi-app-route route="Query.:id" component="Vidyano.WebComponents.QueryPresenter"></vi-app-route>
        <vi-app-route route=":programUnitName/Query.:id" component="Vidyano.WebComponents.QueryPresenter"></vi-app-route>
        <vi-app-route route="PersistentObject.:id(/:objectId)" component="Vidyano.WebComponents.PersistentObjectPresenter"></vi-app-route>
        <vi-app-route route=":programUnitName/PersistentObject.:id(/:objectId)" component="Vidyano.WebComponents.PersistentObjectPresenter"></vi-app-route>
        <vi-app-route route=":programUnitName/FromAction/:fromActionId" component="Vidyano.WebComponents.PersistentObjectPresenter"></vi-app-route>
        <vi-app-route route=":programUnitName(/)" component="Vidyano.WebComponents.ProgramUnitPresenter"></vi-app-route>
        <vi-app-route class="fit" route="SignIn(/)(:returnUrl)" allow-signed-out>
            <vi-sign-in label="[[label]]" image="[[signInImage]]">
                <content select="[label='sign-in']"></content>
            </vi-sign-in>
        </vi-app-route>
        <vi-app-route route="SignOut(/)(:returnUrl)" allow-signed-out>
            <vi-sign-out></vi-sign-out>
        </vi-app-route>
        <vi-app-config>
            <vi-persistent-object-attribute-config type="CommonMark" height="3"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="Reference" height="attr.selectInPlace && attr.getTypeHint('inputtype', '', undefined, true) === 'radio' ? 0 : 1"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="DropDown" height="attr.getTypeHint('inputtype', '', undefined, true) === 'radio' ? 0 : 1"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="KeyValueList" height="attr.getTypeHint('inputtype', '', undefined, true) === 'radio' ? 0 : 1"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="Enum" height="attr.getTypeHint('inputtype', '', undefined, true) === 'radio' ? 0 : 1"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="MultiLineString" height="3"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="MultiString" height="3"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="Image" parent-id="1f364a36-7f9b-43d3-a7a4-11a340937d83" height="5"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="Image" height="2"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="TranslatedString" height="attr.getTypeHint('MultiLine') == 'True' ? 3 : 1"></vi-persistent-object-attribute-config>
            <vi-persistent-object-attribute-config type="AsDetail" height="attr.getTypeHint('Height', 'auto') == 'auto' ? 0 : 6" width="4"></vi-persistent-object-attribute-config>
            <vi-persistent-object-tab-config type="Vidyano.Rule" name="Rule">
                <template is="dom-template">
                    <div class="vertical layout flex">
                        <vi-grid style="padding-top: 0; padding-bottom: 0;">
                            <vi-persistent-object-attribute-presenter desktop-6 attribute="[[tab.attributes.Name]]"></vi-persistent-object-attribute-presenter>
                            <vi-persistent-object-attribute-presenter desktop-6 attribute="[[tab.attributes.Type]]"></vi-persistent-object-attribute-presenter>
                        </vi-grid>
                        <vi-grid class="flex" style="padding-top: 0; padding-bottom: 0;">
                            <vi-persistent-object-attribute-presenter class="layout vertical" desktop-12 tablet-8 phone-6 height="0" attribute="[[tab.attributes.Data]]"></vi-persistent-object-attribute-presenter>
                        </vi-grid>
                    </div>
                </template>
            </vi-persistent-object-tab-config>
            <content select="vi-app-setting, vi-persistent-object-config, vi-persistent-object-attribute-config, vi-persistent-object-tab-config, vi-program-unit-config, vi-query-config, vi-query-chart-config"></content>
        </vi-app-config>
    </template>
</dom-module>

<style>
    button,
    input,
    optgroup,
    select,
    textarea {
        margin: 0;
        font-family: inherit;
    }

    pre {
        border: none;
        font-size: 1em;
        display: block;
        height: auto;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: inherit;
    }

    button {
        border: none;
        outline: none;
    }

    a:focus, a:active,
    button::-moz-focus-inner,
    input[type="reset"]::-moz-focus-inner,
    input[type="button"]::-moz-focus-inner,
    input[type="submit"]::-moz-focus-inner,
    select::-moz-focus-inner,
    input[type="file"] > input[type="button"]::-moz-focus-inner {
        border: 0;
        outline: 0;
    }

    .vertical.layout .flex {
        flex-basis: 0.000000001px;
    }

    iron-a11y-keys {
        display: none;
    }

    &.dragging {
        @include noSelection();

        * {
            @include noSelection(true);
        }
    }

    template {
        display: none;
    }
</style>

<script src="app.js"></script>
<script src="Config/template-config.js"></script>
<script src="Config/persistent-object-config.js"></script>
<script src="Config/persistent-object-attribute-config.js"></script>
<script src="Config/persistent-object-tab-config.js"></script>
<script src="Config/program-unit-config.js"></script>
<script src="Config/query-config.js"></script>
<script src="Config/query-chart-config.js"></script>
<script src="Config/app-config.js"></script>