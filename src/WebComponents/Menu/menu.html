<link rel="import" href="../../Libs/paper-ripple/paper-ripple.html" />
<link rel="import" href="../InputSearch/input-search.html" />
<link rel="import" href="../User/user.html" />

<dom-module id="vi-menu">
    <template>
        <link rel="stylesheet" href="menu.css" />
        <header>
            <button is="vi-button" id="toggleCollapse" on-tap="_toggleCollapse">
                <vi-icon source="Menu_Collapse"></vi-icon>
            </button>
            <div class="label">[[label]]<content select="[label]"></content></div>
            <div id="headerElements"></div>
            <template is="dom-if" if="[[!collapsed]]">
                <vi-input-search value="{{filter}}" on-search="_search"></vi-input-search>
            </template>
            <template is="dom-if" if="[[collapsedWithGlobalSearch]]">
                <vi-popup orientation="horizontal" content-align="right" sticky>
                    <vi-icon header source="Search" on-tap="_focusSearch"></vi-icon>
                    <vi-input-search id="collapsedInputSearch" content collapsed value="{{filter}}" on-tap="_catchInputSearchTap" on-search="_search"></vi-input-search>
                </vi-popup>
            </template>
        </header>
        <template is="dom-if" if="[[!collapsed]]">
            <div class="horizontal layout flex relative">
                <vi-scroller class="flex programUnits" no-horizontal>
                    <template is="dom-repeat" items="[[programUnits]]" as="programUnit">
                        <vi-menu-item class="program-unit" item="[[programUnit]]" filter="{{filter}}" program-unit="[[activeProgramUnit]]" collapsed="[[collapsed]]"></vi-menu-item>
                        <div class="subItems">
                            <template is="dom-repeat" items="[[programUnit.items]]" as="programUnitItem">
                                <vi-menu-item class="program-unit-item" item="[[programUnitItem]]" filter="{{filter}}"></vi-menu-item>
                                <div class="subItems">
                                    <template is="dom-repeat" items="[[programUnitItem.items]]" as="groupItem">
                                        <vi-menu-item class="program-unit-group-item" item="[[groupItem]]" filter="{{filter}}" filter-parent="[[item]]"></vi-menu-item>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </template>
                </vi-scroller>
            </div>
        </template>
        <template is="dom-if" if="[[collapsed]]">
            <div class="flex programUnits">
                <template is="dom-repeat" items="[[programUnits]]" as="programUnit">
                    <vi-popup orientation="horizontal" content-align="right" open-on-hover>
                        <vi-menu-item header class="program-unit" item="[[programUnit]]" program-unit="[[activeProgramUnit]]" collapsed="[[collapsed]]"></vi-menu-item>
                        <vi-scroller content no-horizontal class="subItems" has-group-items$="[[_hasGroupItems(programUnit.items)]]" item-count$="[[_countItems(programUnit.items)]]">
                            <template is="dom-repeat" items="[[programUnit.items]]" as="programUnitItem">
                                <vi-menu-item class="program-unit-item" item="[[programUnitItem]]"></vi-menu-item>
                                <div class="subItems">
                                    <template is="dom-repeat" items="[[programUnitItem.items]]" as="groupItem">
                                        <vi-menu-item class="program-unit-group-item" item="[[groupItem]]"></vi-menu-item>
                                    </template>
                                </div>
                            </template>
                        </vi-scroller>
                    </vi-popup>
                </template>
            </div>
        </template>
        <footer>
            <div id="footerElements"></div>
            <vi-user collapsed="[[collapsed]]"></vi-user>
        </footer>
        <div id="resizer" on-track="_onResize"></div>
    </template>
</dom-module>

<dom-module id="vi-menu-item">
    <template>
        <link rel="stylesheet" href="menu-item.css" />
        <paper-ripple></paper-ripple>
        <vi-icon class="group" source="Forward"></vi-icon>
        <a href$="[[href]]" id="title" on-mouseenter="_titleMouseenter"></a>
    </template>
</dom-module>

<script src="menu.js"></script>