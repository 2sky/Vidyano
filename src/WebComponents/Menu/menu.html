<link rel="import" href="../../Libs/paper-ripple/paper-ripple.html" />
<link rel="import" href="../InputSearch/input-search.html" />
<link rel="import" href="../User/user.html" />

<dom-module id="vi-menu">
    <template>
        <link rel="stylesheet" href="menu.css" />
        <header>
            <button is="vi-button" id="toggleCollapse" on-tap="_toggleCollapse">
                <vi-icon source="Menu_Collapse"></vi-icon>
            </button>
            <span>{{label}}</span>
            <content select="[menu-element~='start']"></content>
            <vi-input-search collapsed="{{collapsed}}" value="{{filter}}" on-search="_search"></vi-input-search>
        </header>
        <template is="dom-if" if="{{!collapsed}}">
            <vi-scroller class="flex programUnits" no-horizontal>
                <template is="dom-repeat" items="{{items}}">
                    <vi-menu-item class="program-unit" item="{{item}}" filter="{{filter}}" program-unit="{{programUnit}}" collapsed="{{collapsed}}"></vi-menu-item>
                    <div class="subItems">
                        <template is="dom-repeat" items="{{item.items}}">
                            <vi-menu-item class="program-unit-item" item="{{item}}" filter="{{filter}}"></vi-menu-item>
                            <div class="subItems">
                                <template is="dom-repeat" items="{{item.items}}" as="groupItem">
                                    <vi-menu-item class="program-unit-group-item" item="{{groupItem}}" filter="{{filter}}" filter-parent="{{item}}"></vi-menu-item>
                                </template>
                            </div>
                        </template>
                    </div>
                </template>
            </vi-scroller>
        </template>
        <template is="dom-if" if="{{collapsed}}">
            <div class="flex programUnits">
                <template is="dom-repeat" items="{{items}}">
                    <vi-popup orientation="horizontal" content-align="right" open-on-hover>
                        <vi-menu-item header class="program-unit" item="{{item}}" program-unit="{{programUnit}}" collapsed="{{collapsed}}"></vi-menu-item>
                        <div content class="subItems" has-group-items$="{{_hasGroupItems(item.items)}}" item-count$="{{_countItems(item.items)}}">
                            <template is="dom-repeat" items="{{item.items}}">
                                <vi-menu-item class="program-unit-item" item="{{item}}"></vi-menu-item>
                                <div class="subItems">
                                    <template is="dom-repeat" items="{{item.items}}" as="groupItem">
                                        <vi-menu-item class="program-unit-group-item" item="{{groupItem}}"></vi-menu-item>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </vi-popup>
                </template>
            </div>
        </template>
        <footer>
            <content select="[menu-element~='end']"></content>
            <vi-user collapsed="{{collapsed}}"></vi-user>
        </footer>
    </template>
</dom-module>

<dom-module id="vi-menu-item">
    <template>
        <link rel="stylesheet" href="menu-item.css" />
        <paper-ripple></paper-ripple>
        <vi-icon class="group" source="Forward"></vi-icon>
        <a href="{{href}}" title="" id="title"></a>
    </template>
</dom-module>

<script src="menu.js"></script>